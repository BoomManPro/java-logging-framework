# 日志

42
日志和异常处理结合得当的话，会给项目维护带来非常大的`价值`。


## 日志是什么?

就是介绍一个过程和经历的详细记录。


### 本项目思路

- 日志在项目中的作用

- Java 日志使用的困惑

- Java 日志演化历史

- Spring Boot 项目集成日志框架实战

- 项目中日志记录遵守哪些原则

- 一个推荐的项目 Java 日志实例

- chulejava日志还有哪些

## 一个项目会有什么日志呢?

### 项目日志

项目开发过程的详细记录，一般由项目经理记录。 滨哥..

### 逻辑日志

就是程序员记录某个开发过程(代码中的注释也算吧)的详细情况，这是项目里每个程序员需要做的工作。

举个栗子(项目功能基于第三方接口，为了便于甩锅，遂需要记录日志)

举个栗子(项目某个功能现阶段因为某些原因。实现较为复杂，后期一定会改进，遂需要记录设计文档)

### 代码里的日志

在项目中扮演着非常重要的角色，日志记录的详细程度决定系统是否容易维护，Java 项目中日志记录的框架有很多，在项目中如何选型也必将困惑。



## 日志在项目中的作用

一、日志在项目中的作用

Log 日志，主要用于记录程序运行的情况，以便于程序在部署之后的排错调试等，也有利于将这些信息进行持久化（如果不将日志信息保存到文件或数据库，则信息便会丢失）。

1. 查看程序当前运行状态

如果想了解程序当前的运行情况，我们通过实时查看应用日志的输出，就能进行分析。

比如，你在浏览器里输入一个 action 地址，该 url 负责执行一些批量处理，action 运行后，假设处理比较耗时，你再浏览器里无法直接看到程序的执行结果，此时，你可以打开系统日志，通过从日志输出信息就能轻松地分析该 url 的执行情况。

2. 查看程序历史运行轨迹

如果想了解历时程序的运行情况，我们通过查看应用历时日志的输出，就能进行分析。

比如，你想了解下上周周末用户访问量，你可以打开系统上周周末的日志记录，进行分析。你想了解昨天的某个定时任务是否正常执行，你可以打开昨天的系统日志，精确查找该定时任务的输出信息，从而判断定时任务是否执行。

3. 排查系统问题

排查系统问题是程序员最熟悉的味道了，在项目维护过程中，出了任何问题，都需要程序员去进行排查。此时，如果没有清楚明了的日志记录，想要核查出问题的原因，难于上青天。

一个优秀的程序员一定是个日志记录高手，如果日志记录的好，处理得当，排查问题则易如反掌。

大家有没有遇到一种场景，一个问题发生了，有的人能迅速定位问题并解决，有的人搞了半天，还没发现问题的产生原因。

其实快速定位问题的人一定记录了详细的日志，因此当问题发生的时候，通过核查问题发生时候的日志，就能快速的找出问题产生的原因。

4. 优化系统性能

通过记录程序运行的时间，就能判断程序从执行开始到执行结束消耗的时间，从而判断系统性能是否达标，为系统性能优化提供判断依据。

5. 安全审计的基石

网络安全越来越受到大家的关注，所以系统安全目前是项目过程非常重要的一个环节，安全审计也是系统中非常重要的部分。

通过系统日志分析，可以判断一些非法攻击，非法调用，以及系统处理过程中的安全隐患。

比如，大家平时都在做运营系统，其中运营人员在通过界面处理一些数据的时候，如果没有清楚的日志操作记录，一条数据被删除或者修改，你是无法找到是谁操作的，但是如果你做了相应的记录，该数据被谁删除或者修改就会一目了然。

通过以上 5 点说明了日志在项目维护过程中的重要作用

一个系统是否容易维护，很大程度上是基于程序员在程序开发过程中的代码日志是怎么记录的。

日志记录的越清楚，维护起来就越容易，有的程序员没有日志记录意识，或者对日志记录认识不清，或者是不知道日志该如何记录，这势必会给项目后期的维护带来一个个大坑。

当项目经理让你解决一个线上问题的时候，正好遇到了一个没有日志记录习惯的人写的代码，你就能体会到那种痛苦，不由地想要爆粗口。

因此，作为一个程序员来说，掌握代码日志的记录方法，是程序员生涯的一项基本功。写代码时做好日志记录是“即利人又利己”的做法，不写日志记录就是“损人不利己”的做法。

## Java日志使用的困惑

大多数的程序员都能认识到日志在项目中的重要性，可是对日志记录具体要怎么做，做到什么程度，日志记录用什么工具，会有很多困惑。

1. 工具困惑

作为 Java 程序员，幸运的是，Java 拥有功能和性能都非常强大的日志库；不幸的是，这样的日志库有不止一个，相信每个人都会对JUL(Java Util Log)、JCL(Commons Logging)、Log4j、SLF4J、Logback、Log4j2 等等的日志工具，到底使用什么产生感到困扰。


2. 使用困惑

有的程序员即使知道写 Java 程序用什么日志工具，可能对日志记录具体应该怎么写，写什么东西，什么情况下要写，这些仁者见仁智者见智的东西也会产生困扰。

## Java 日志演化历史


说起Java日志你会想起什么

`SUN` `Apache` `Spring`

`Sl4j` `JCL` `JakartaCommons Logging` `Java Commons Logging` `Apache Commons Logging`

`Java Util Logging` `JUL``Java Logging` `Log4j` `Log4j2` `Logback` 

`Ceki Gülcü `



一、Sun在1996 年1月23日发布了JDK1.0

二、J2SE 1.4.0 Merlin 灰背隼 2002-02-13  Jul->java util logging 出现 即java自身的日志框架有了

那么问题来了 1996-2002 Java开发者使用什么记录日志呢?


在JDK 1.3及以前，Java打日志依赖System.out.println(), System.err.println()或者e.printStackTrace()，Debug日志被写到STDOUT流，错误日志被写到STDERR流。这样打日志有一个非常大的缺陷，即无法定制化，且日志粒度不够细。

于是， Gülcü 于2001年发布了Log4j，后来成为Apache 基金会的顶级项目。Log4j 在设计上非常优秀，对后续的 Java Log 框架有长久而深远的影响，它定义的Logger、Appender、Level等概念如今已经被广泛使用。Log4j 的短板在于性能，在Logback 和 Log4j2 出来之后，Log4j的使用也减少了。


最先出现的是 Apache 开源社区的 Log4j([Log4j官网](https://logging.apache.org/log4j/2.x/manual/index.html)1996年左右.出现可能比java还要早)，这个日志确实是应用最广泛的日志工具，成为了 Java 日志的事实上的标准。

当初Apache极力游说Sun把log4j加入JDK1.4， 然而JDK1.4项目小组已经接近发布JDK1.4产品的时间了，因此拒绝了Apache的要求，使用自己的java.util.logging，这个包 的功能比log4j差的很远，性能也一般。

```
你可以选择log4j，java.util.logging或 者它自带的Simple Logger。不过我仍然强烈建议使用log4j，
因为log4j性能很高，log输出信息时间几乎等于System.out，而处理一条log平均只需 要5us。
```

Log4j简述
```
log4j  End of Life in August 2015

Log4j 是基于Java开发的日志框架，其作者Ceki Gülcü将Log4j捐献给了Apache软件基金会，使之成为了Apache日志服务的一个子项目。 
Log4j虽然是Java日志服务，因其出色的表现，被孵化出了支持C, C++, C#, Perl, Python, Ruby等语言的子框架。 
Log4j早在1996年就被创立，之后经过改进与增强，正式对外发布。 
2015年9月，Apache软件基金业宣布，Log4j不在维护，建议所有相关项目升级到Log4j2.
```


当2002年Java开发出Jul时,Log4j用户使用的也有很多,当一个系统同时使用这两个日志框架时，那会不会出现问题?

为什么 JUL 的出现会导致开发局面混乱呢？

想象下你的项目应用使用 Log4j，然后使用了一个第三方库，而第三方库使用了 JUL，那么，你的应用就得同时使用 Log4j 和JUL两个日志工具了，然后又有需要使用另外一个第三方库，但是这个第三方库使用了 Log4j 和 JUL 之外的 simplelog。这个时候你的应用里各种 log 工具满天飞，这势必会使你的程序员感到崩溃。因为这些日志工具互相没有关联，替换和统一日志工具也就变成了比较棘手的一件事情。

如果你遇到了这种问题，你该如何解决呢？

Apache Commons Logging,又名JakartaCommons Logging (JCL) 也是spring自身在使用的日志框架

解决这个问题，我们会用到一个设计模式——“适配器模式”，即把这个问题进行抽象，抽象出一个接口层，对每个日志实现都进行适配，这样这些提供给别人的库都直接使用抽象的接口层即可。

为了搞定这个日常开发中比较棘手的问题，Apache 开源社区提供了一个日志框架作为日志的抽象，叫 commons-logging，也被称为 JCL(java common logging)，JCL 对各种日志接口进行抽象，抽象出一个接口层，对每个日志实现都进行适配，这样这些提供给别人的库都直接使用抽象层即可，确实出色地完成了兼容主流的日志实现（Log4j、JUL、simplelog 等），较好的解决了上述问题，基本一统江湖，就连顶顶大名的 spring 也是依赖了 JCL。

但是美好的日子并不长，作为元老级日志 Log4j 的作者 (Ceki Gülcü)，他觉得 JCL 不够优秀，所以他再度出山，搞出了一套更优雅的日志框架 SLF4J（这个也是抽象层），即简单日志门面（Simple Logging Facade for Java），并为 SLF4J 实现了一个亲儿子——logback，确实更加优雅了。

最后，Ceki Gülcü 觉得还是得照顾下自己的 “大儿子”——Log4j，又把 Log4j 进行了改造，就是所谓的 Log4j2，同时支持 JCL 以及 SLF4J。

SLF4J 的出现，又使 Java 日志体系变得混乱起来。

下面是一张目前 Java 日志体系的示意图：


日志库 Log4j，JUL，logback 是互相不兼容的，没有共同的 Interface，所以 commons-logging、SLF4J 通过适配器模式，抽象出来一个共同的接口，然后根据使用的具体日志框架来实现日志。

java common logging 和 SLF4J 都是日志的接口，供用户使用，而没有提供实现，Log4j，JUL，logback 等等才是日志的真正实现。

当我们调用日志接口时，接口会自动寻找恰当的实现，返回一个合适的实例给我们服务。这些过程都是透明化的，用户不需要进行任何操作。


Logback Ceki Gülcü 

```
Logback - Logback是由log4j创始人设计的又一个开源日记组件。logback当前分成三个模块：logback-core,logback- classic和logback-access。logback-core是其它两个模块的基础模块。logback-classic是log4j的一个改良版本。此外logback-classic完整实现SLF4J API使你可以很方便地更换成其它日记系统如log4j或JDK14 Logging；
Logback是Log4j的作者的另一个开源日志组件，与Log4j相比，Logback重新了内核，使它的性能提升了很多，大约是Log4j的10倍，同时占用更小的内存，并且完整的实现了SLF4J API是你可以很方便的切换日志框架。
```


SLF4J（Simple Logging Facade For Java）简单日志门面，和JCL功能类似，但JCL有一个致命的缺点就是算法复杂，出现问题难以排除，而SLF4J的诞生就是为了解决JCL的缺点。

值得一提的是SLF4J的作者就是Log4j的作者。



Log4j2有着和Logback相同的功能，但又有自己单用的功能，比如：插件式结构、配置文件优化、异步日志等。

Log4j2是Log4j的升级，它比其前身Log4j 1.x提供了重大改进，并提供了Logback中可用的许多改进，同时修复了Logback架构中的一些固有问题。

从GitHub的更新日志来看，Logback已经有半年没有更新了，而作为知名组织的Apache下的Log4j2的更新却是非常活跃的，Log4j 1.x 于2015年8月停止维护更新了。


Gülcü Log4j -> Apache
Gülcü Sl4j
Gülcü Logback 原生支持Sl4j

工具	官方网站
Log4j	http://logging.apache.org/log4j/1.2
JCL	http://commons.apache.org/proper/commons-logging/
SLF4J	http://www.slf4j.org
logback	http://logback.qos.ch
Log4j2	https://logging.apache.org/log4j/2.x/


## Spring Boot 集成日志框架


##  日志规范 

一个在生产环境里运行的程序如果没有日志是很让维护者提心吊胆的，有太多杂乱又无意义的日志也是令人伤神。程序出现问题时候，从日志里如果发现不了问题可能的原因是很令人受挫的。本文想讨论的是如何在Java程序里写好日志。

一般来说日志分为两种：业务日志和异常日志，使用日志我们希望能达到以下目标：

对程序运行情况的记录和监控；
在必要时可详细了解程序内部的运行状态；
对系统性能的影响尽量小；

Link: 

- Alibaba-p3c

- 日志实战规范建议    


## 一个推荐的项目 Java 日志实例








